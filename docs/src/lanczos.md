# Lanczos


Here we show how to use PauliStrings.jl to run the recursion method and compute [`lanczos`](@ref) coefficients.
We will focus on reproducing the X in XX results from figure 2 of [Parker 2019](https://journals.aps.org/prx/abstract/10.1103/PhysRevX.9.041017).

Start by importing PauliStrings:
```jldoctest lanczos; output=false
using PauliStrings
import PauliStrings as ps

# output
```

Define the XX Hamiltonian $$H = \sum_i X_iX_{i+1}+Y_iY_{i+1}$$ on a 1D chain with periodic boundary conditions
```jldoctest lanczos; output=false
function XX(N)
    H = ps.Operator(N)
    for j in 1:(N - 1)
        H += "X",j,"X",j+1
        H += "Z",j,"Z",j+1
    end
    H += "X",1,"X",N
    H += "Z",1,"Z",N
    return H
end

# output

XX (generic function with 1 method)
```
and the X operator $$\sum_{i=1}^N X_i$$
```jldoctest lanczos; output=false
function X(N)
    H = ps.Operator(N)
    for j in 1:N
        H += "X",j
    end
    return H
end
# output

X (generic function with 1 method)
```

Initialize a Hamiltonian and an operator:
```jldoctest lanczos; output=false
N = 50 # system size
H = XX(N) # Hamiltonian
O = X(N) # operator

# output
(1.0 + 0.0im) X1111111111111111111111111111111111111111111111111
(1.0 + 0.0im) 1X111111111111111111111111111111111111111111111111
(1.0 + 0.0im) 11X11111111111111111111111111111111111111111111111
(1.0 + 0.0im) 111X1111111111111111111111111111111111111111111111
(1.0 + 0.0im) 1111X111111111111111111111111111111111111111111111
(1.0 + 0.0im) 11111X11111111111111111111111111111111111111111111
(1.0 + 0.0im) 111111X1111111111111111111111111111111111111111111
(1.0 + 0.0im) 1111111X111111111111111111111111111111111111111111
(1.0 + 0.0im) 11111111X11111111111111111111111111111111111111111
(1.0 + 0.0im) 111111111X1111111111111111111111111111111111111111
(1.0 + 0.0im) 1111111111X111111111111111111111111111111111111111
(1.0 + 0.0im) 11111111111X11111111111111111111111111111111111111
(1.0 + 0.0im) 111111111111X1111111111111111111111111111111111111
(1.0 + 0.0im) 1111111111111X111111111111111111111111111111111111
(1.0 + 0.0im) 11111111111111X11111111111111111111111111111111111
(1.0 + 0.0im) 111111111111111X1111111111111111111111111111111111
(1.0 + 0.0im) 1111111111111111X111111111111111111111111111111111
(1.0 + 0.0im) 11111111111111111X11111111111111111111111111111111
(1.0 + 0.0im) 111111111111111111X1111111111111111111111111111111
(1.0 + 0.0im) 1111111111111111111X111111111111111111111111111111
(1.0 + 0.0im) 11111111111111111111X11111111111111111111111111111
(1.0 + 0.0im) 111111111111111111111X1111111111111111111111111111
(1.0 + 0.0im) 1111111111111111111111X111111111111111111111111111
(1.0 + 0.0im) 11111111111111111111111X11111111111111111111111111
(1.0 + 0.0im) 111111111111111111111111X1111111111111111111111111
(1.0 + 0.0im) 1111111111111111111111111X111111111111111111111111
(1.0 + 0.0im) 11111111111111111111111111X11111111111111111111111
(1.0 + 0.0im) 111111111111111111111111111X1111111111111111111111
(1.0 + 0.0im) 1111111111111111111111111111X111111111111111111111
(1.0 + 0.0im) 11111111111111111111111111111X11111111111111111111
(1.0 + 0.0im) 111111111111111111111111111111X1111111111111111111
(1.0 + 0.0im) 1111111111111111111111111111111X111111111111111111
(1.0 + 0.0im) 11111111111111111111111111111111X11111111111111111
(1.0 + 0.0im) 111111111111111111111111111111111X1111111111111111
(1.0 + 0.0im) 1111111111111111111111111111111111X111111111111111
(1.0 + 0.0im) 11111111111111111111111111111111111X11111111111111
(1.0 + 0.0im) 111111111111111111111111111111111111X1111111111111
(1.0 + 0.0im) 1111111111111111111111111111111111111X111111111111
(1.0 + 0.0im) 11111111111111111111111111111111111111X11111111111
(1.0 + 0.0im) 111111111111111111111111111111111111111X1111111111
(1.0 + 0.0im) 1111111111111111111111111111111111111111X111111111
(1.0 + 0.0im) 11111111111111111111111111111111111111111X11111111
(1.0 + 0.0im) 111111111111111111111111111111111111111111X1111111
(1.0 + 0.0im) 1111111111111111111111111111111111111111111X111111
(1.0 + 0.0im) 11111111111111111111111111111111111111111111X11111
(1.0 + 0.0im) 111111111111111111111111111111111111111111111X1111
(1.0 + 0.0im) 1111111111111111111111111111111111111111111111X111
(1.0 + 0.0im) 11111111111111111111111111111111111111111111111X11
(1.0 + 0.0im) 111111111111111111111111111111111111111111111111X1
(1.0 + 0.0im) 1111111111111111111111111111111111111111111111111X
```

Compute and plot the [`lanczos`](@ref) coefficients for different truncations.
For each level of truncation, we keep only $$2^p$$ terms with the highest weight at each step of the [`lanczos`](@ref) algorithm.
```julia
ioff() # pyplot
# nterms is the max pauli string length
for p in (14,16,18,20)
    @time bs = ps.lanczos(H, O, 20, 2^p; keepnorm=true)
    plot(bs, label="trim: 2^$p")
end
legend()
ylabel(L"$b_n$")
xlabel(L"$n$")
title("X in XX, N=$N spins")
savefig("lanczos_example.png")
show()
```
![plot](./assets/lanczos_example.png)


# Tacking advantage of translation symmetry
If the problem has translation symmetry, we can take advantage of the symmetry to save time and memory. Just pass $$O$$ and $$H$$ as [`OperatorTS`](@ref) to [`lanczos`](@ref). For example:
```jldoctest lanczos; output=false, filter = r"(\d*)\.(\d{4})\d+" => s"\1.\2***"
p=14
Hts = OperatorTS{(N,)}(H)
Ots = OperatorTS{(N,)}(O)
bs = ps.lanczos(Hts, Ots, 20, 2^p; keepnorm=true, show_progress=false);

# output

20-element Vector{Float64}:
 141.4213562373095
 200.0
 244.94897427831782
 282.84271247461896
 316.22776601683796
 346.41016151377545
 374.16573867739413
 400.00000000000006
 424.26406871192853
 447.21359549995793
 469.041575982343
 489.8979485566357
 509.9019513592785
 529.150262212918
 547.7225575051662
 565.685424949238
 583.0951894845301
 600.0
 616.4414002968986
 632.4555302349
```
Check the [translation symmetry tutorial](@ref translation).
